\documentclass[a4paper,12pt,fleqn]{scrartcl}
\usepackage[l2tabu,orthodox]{nag}% Old habits die hard. All the same, there are commands, classes and packages which are outdated and superseded. nag provides routines to warn the user about the use of those.

\usepackage[all,error]{onlyamsmath}% Error on deprecated math commands like $$ $$.
\usepackage[strict=true]{csquotes}

\usepackage{listings}
\lstset{frame=single,framerule=0pt,language={C},showstringspaces=false,numbers=left,columns=fullflexible}

\usepackage{2111defs2}
\usepackage[colorlinks=true]{hyperref}

\newcommand{\assn}[1]{{\color{red}\left\{#1\right\}}}
\newcommand{\remark}[1]{{\sffamily\color{blue}{#1}}}

% define some convenience macros specific to this task
\newcommand{\str}{\mathsf{str}}

\title{Assignment 1}
\author{z5131048\and Fiona Lin}

\begin{document}
\maketitle
\section{Task 1}
\label{sec:task-1}

The program that mimics uniq filters adjacent matching lines from INPUT (or standard input), writing to OUTPUT (or standard output). It is assuming the input has an array of strings $a$ and a variable $n$ contains a non-negative integer, the number of elements of the array $a$, and the output has an array of strings $b$ stores $k$ (a non-negative integer) elements same in the array $a$ but having any adjacent identical strings removed. The program should changes neither $n$ nor $a$. \\
\\
With a non-negative integer $n$, the array $a$ contains $n$ strings elements, the array $a$ in fact is a 2-dimesion char array. As an element within the array $a$, the string with arbitary length $\ell$ contains a permutation of characters, based on certain ASCII encoding. Having defined that string $a[i]$ with a length $\ell$ with 8-bit ASCII encoding by\\
\begin{gather*}
	\str(a,n) = \All{i\in 0..(n-1)} \AND {\exists \ell\in N} \And \All{h\in 0..(\ell-1)}{\Exi{e\in 0..255}{a[i][h]=e}}
\end{gather*}
It is defined the array $a$ contains $n$ strings by: \quad $\All{i\in 0..(n-1)} {str(a,n)}$\\
\\
The precondition is defined as:
\begin{gather*}
	\All{i\in 0..(n-1)} {str(a,n)\And a}=a_0
\end{gather*}
Thus it states that the array $a$ contains $n$ string elements, and it has captured the initial value for later reference in the postcondition
\begin{gather*}
\All{i\in 0..(k-2)} {str(b,k) \subset str(a,n) \AND a = a_0 \And (b[i] \neq b[i+1])}
\end{gather*}
Having assumed that the output has an array of strings $b$ stores $k$ (a non-negative integer) elements same in the array $a$ but having any adjacent identical strings removed. The program should leave the integer $n$ and the array $a$ remaining the same as original.
\\
\section{Task 2}
\label{sec:task-2}
We propose the following proof outline to demonstrate the correctness
of our code (in black).
\begin{gather*}
	\assn{{str(a,n)\And a}=a_0}\\
	i\Ass 0;\qquad 1st\Implies\assn{I\subst 0i\subst 0k}\\
	k\Ass 0;\\
	\assn{I}\\
	\WHILE~i<n~\DO \qquad\assn{I\And i<n}\\
	\quad \IF ~i=0~\\
	\qquad \assn{I\AND i=0}\quad 2nd \Implies	\qquad \assn{I\subst0i\subst0k\subst{(b:k\mapsto a[i])}b }\\
	\qquad b[k]\Ass a[i];\\
	\quad \ELSE\\
	\quad \assn{I\subst{i+1}i\subst{k+1}k \AND 1\leq i<n}\\
	\qquad h \Ass 0;\quad\assn {J\subst0h}\\
	\qquad\assn{J}\\
	\qquad \WHILE ~ a[i][h] \neq '\setminus0' \AND b[k][h] = a[i][h]~ \DO\\
	\qquad \assn{J \AND 0\leq h \AND a[i][h] \neq '\setminus0' \AND b[k][h] = a[i][h] }\\
	\qquad\quad \assn{J{\subst {h+1}h}}\\
\qquad\quad h \Ass h+1;\\
\qquad\quad \assn{J}\\
\qquad \OD\\
\qquad\assn {J \AND (\All{h\in N}{b[k][h]=a[i][h]}) \OR \Exi{h\in N}{b[k][h] \neq a[i][h]})}\\
\qquad 5th \Implies \assn {I\subst{i+1}i\subst{k+1}k \AND (\All{h\in N}{b[k][h]=a[i][h]}) \OR \Exi{h\in N}{b[k][h] \neq a[i][h]})}\\
\qquad \IF ~ a[i][h] \neq b[k][h]~ \\
\qquad \assn{(0<i<n) \AND \Exi{h\in N}{a[i][h] \neq b[k][h]}\AND I \subst{i+1}i}\\
\qquad\quad k\Ass k+1 \qquad 3rd \Implies\assn{I \subst{i+1}i\subst{k+1}k \subst{(b:k\mapsto a[i])}b }\\
\qquad\quad b[k]\Ass a[i];\\
\qquad \FI\\
\quad \FI\\
\quad \assn{I\subst{i+1}i}\\
\quad i\Ass i+1\\
\quad \assn{I}\\
\OD;\\
\assn{I\And i\geq n} \qquad 4th \Implies\\
\assn{\All{i\in 0..(k-2)} {str(b,k) \subset str(a,n) \AND a = a_0 \And (b[i] \neq b[i+1])}}
\end{gather*}


where our invariants are
\begin{align*}
	%
	& \ I=str(a_0,n)\AND a = a_0 \AND (0\leq i< n) \AND (0\leq j< k-2) \\
	& \AND \All{j\in 0..(k-2)} {str(b,k) \subset str(a,i) \And (b[j] \neq b[j+1])}\\
	& \ J=I\subst{i+1}i\subst{k+1}k \AND i\geq 1\AND(\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]})
\end{align*}


	
\subsection{First implication: ${str(a,n)\And a}=a_0 \Implies I\subst 0i\subst 0k$}
\label{sec:first-impl-assnj}
\begin{align*}
	& \str(a,n)\And a=a_0\\
	%
	\justification[\Implies]{using $n\in\nat$ and realising that the last conjunct is vacuously true}\\
	%
	& \str(a_0,n) \AND a = a_0\AND (0\leq i< n) \AND (0\leq j< k-2) \AND\\
	&  \All{j\in 0..(k-2)} {str(b,k) \subset str(a,i)  \And (b[j] \neq b[j+1])}\\
	% 
	\justification[\Implies]{definitions of $I$ and substitution, since k is 0, str(b,k) is str(b,0)}
	%
	& \str(a_0,n) \AND a = a_0\AND (0\leq 0< n) \AND (0\leq j<0) \AND\\
	&  \All{j\in 0..(0-2)}{str(b,0) \subset str(a,0)  \And (b[j] \neq b[j+1])}\\
	% \justification[\Implies]
		\justification{definitions of $I$ and substitution}
	%
	  & I\subst 0i\subst 0k                                                                       
	\end{align*}
	\remark{Since str(b,0) is $\emptyset$ similarly str(a,0) is $\emptyset$ hence $str(b,0) \subset str(a,0)$ and $b[0+1]$ is non-exist, then $b[1]\neq b[0]$ is always true. }

% $I\And i<n \Implies ((i=0 \AND I\subst0i\subst0k) \OR (0<i<n \AND \Exi{h\in N}{a[i][h] \neq b[k][h]}\AND I\subst{i+1}i\subst{k+1}k))\AND I\subst{(b:k\mapsto a[i])}b$}

\subsection{Second implication: $I \AND i=0 \Implies I\subst0i\subst0k\subst{(b:k\mapsto a[i])}b$}
\label{sec:second-impl-assnj}
\begin{align*}
	& I \AND i=0 \\
	% 
	\justification[\Implies]{definitions of $I$ and substitution}\\
	%
	&  i=0 \AND 0\leq i<n \AND str(a_0,n) \AND a = a_0\AND (0\leq i< n) \AND (0\leq j< k-2) \AND\\
	&  \All{j\in 0..(k-2)} {str(b,k) \subset str(a,i)  \And (b[j] \neq b[j+1])}\subst 0i\subst 0k\\
	% 
	\justification[\Implies]{simplify, since i and k is 0, str(b, 0) is same as str(a,0)}
	%
	& 0\leq 0 <n \AND str(a_0,n) \AND a = a_0\AND (0\leq 0< n) \AND (0\leq j< 0-2) \AND\\
	&  \All{j\in 0..(0-2)} {str(b,0) \subset str(a,0) \And (b[j] \neq b[j+1])}\subst{(b:0\mapsto a[0])}b\\	
	% 
	\justification[\Implies]{since str(b,0) is $\emptyset$ and $b[0+1]$ is non-exist, then $b[1]\neq b[0]$ is always true}
	%
	& 0\leq 0<n \AND \str(a_0,n) \AND a = a_0\AND 0\leq 0<-2\AND \\
	& \All{j\in 0..(0-2)} {str(b,0) \subset str(a,n) \And (b[0] \neq a[0+1])}\\	
	%	\justification[\Implies]
	\justification{similarly $b[0+1]$ is non-exist, then $b[1]\neq a[0]$ is true}
	& I\subst 0i\subst 0k\subst{(b:k\mapsto a[i])}b  
\end{align*}


\subsection{Third implication: \\$ (0<i<n) \AND \Exi{h\in N}{a[i][h] \neq b[k][h]} \AND I \subst{i+1}i\Implies I\subst{i+1}i\subst{k+1}k\subst{(b:k\mapsto a[i])}b $}
\label{sec:third-impl-assnj}
First we expand I and perform the substitutions to arrive at\\
\begin{align*}
	& I\AND (0<i<n)\AND\Exi{h\in N}{a[i][h]\neq b[k][h]}\AND I\subst{i+1}i\\
	\justification[\Implies]{definitions of $I$ and substitution}\\
	& 0<i+1<n \AND\Exi{h\in N}{a[i+1][h]\neq b[k][h]}\AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-2) \\
  & \AND\All{j\in 0..k-2} {str(b, k) \subset str(a,i+1) \And (b[j] \neq b[j+1])}\\
	\justification[\Implies]{let j = k, since $a[i+1][h]\neq b[k][h]$, $str(b,k+1) \subset str(a,i+1)$ remains true}
	& 0<i+1<n \AND\Exi{h\in N}{a[i+1][h]\neq b[k][h]}\AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-2) \\
	& \AND ( \All{j\in 0..(k-2)} {str(b, k) \subset str(a,i+1) \And b[j] \neq b[j+1]) \AND (j = k \AND b[k] \neq a[i+1])}\\
	\justification[\Implies]{merger $a[i+1][h]\neq b[k][h]$ to str(b,k)}
	& 0<i+1<n \AND\Exi{h\in N}{a[i+1][h]\neq b[k][h]}\AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-1) \\
	& \AND \All{j\in 0..(k-1)} {str(b, k+1) \subset str(a,i+1) \And (b[j] \neq b[j+1]}\\
	\justification[\Implies]{simplify}
	& 0<i+1<n \AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-1) \\
	& \AND\All{j\in 0..k-1} {str(b,k+1) \subset str(a,i+1) \And b[j] \neq b[j+1]}\\
	% \justification[\Implies]	
	\justification{definitions of $I$ and substitution}
	&
	\ I\subst{i+1}i\subst{k+1}k\subst{(b:k\mapsto a[i])}b
\end{align*}

\subsection{Forth implication: $I\And i\geq n\Implies\All{i\in 0..(k-2)} {str(b,k) \subset str(a,n) \AND a = a_0 \And (b[i] \neq b[i+1])}$}
\label{sec:forth-impl-assnj}
\begin{align*}
	  & I \AND i\geq n\\
	\justification[\Implies]{definitions of $I$ and substitution}\\
	%
	  &  str(a_0,n) \AND a = a_0\AND (0\leq i< n) \AND (0\leq j< k-2) \AND\\
	  & \All{j\in 0..(k-2)} {str(b,k) \subset str(a,i)  \And (b[j] \neq b[j+1])}\AND i\geq n\\
	% 
	\justification[\Implies]{simplify, as i = n, and make j as i}
	%
	  & str(a_0,n) \AND a = a_0\AND (0\leq i< k-2) \AND\\
	  & \All{i\in 0..(k-2)} {str(b,k) \subset str(a,n)  \And (b[i] \neq b[i+1])}\\	
	%	\justification[\Implies]
	\justification{simplify}
	  & \All{i\in 0..(k-2)} {str(b,k) \subset str(a,n) \AND a = a_0 \And (b[i] \neq b[i+1])}
\end{align*}

\subsection{Fifth implication: \\$J\AND 1\leq i<n \Implies I\subst{i+1}i\subst{k+1}k \AND (\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]})$}
\label{sec:fifth-impl-assnj}
\begin{align*}
& \ J\AND 1\leq i<n \\
\justification[\Implies]{definitions of $J$ and substitution}
& I\subst{i+1}i\subst{k+1}k \AND i\geq 1\AND\\
& \ (\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]}) \AND 1\leq i<n \\
\justification[\Implies]{simplify,definitions of $I$ and substitution}
& 0<i+1<n \AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-1) \\
& \AND\All{j\in 0..k-1} {str(b,k+1) \subset str(a,i+1) \And b[j] \neq b[j+1]} \AND 1\leq i<n\\
& \AND (\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]}) \\
\justification[\Implies]{simplify}
& 1<i+1<n \AND str(a_0,n) \AND a = a_0 \AND (0\leq j<k-1) \\
& \AND\All{j\in 0..k-1} {str(b,k+1) \subset str(a,i+1) \And b[j] \neq b[j+1]}\\
& \AND (\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]}) \\
%\justification[\Implies]
\justification{definitions of $I$ and substitution}
&\ I\subst{i+1}i\subst{k+1}k \AND (\Exi{h\in N} {b[k][h] \neq a[i][h]} \OR \All{h\in N}{a[i][h]=b[k][h]}) 
\end{align*}


\section{Task 3}
\label{sec:task-3}

\lstinputlisting{uniq.c}
In our C implementation, we opted for the more traditional
\lstinline{for} loop idiom instead of a \lstinline{while} loop. It should be clear that our \lstinline{for} loop captures the meaning of the entire WHILE loop in the toy language program. As for string copy(as proved and demonstrated in lecture, here has assuming the function of string copy is always true), we used a call of the C library function \lstinline{strcpy} to implement the if branch (pseudo-code ``$b[k]\Ass a[i]$'') that copies the content of array $a$ into array $b$. (Cf.~\lstinline{man strcpy}.)
\end{document}
