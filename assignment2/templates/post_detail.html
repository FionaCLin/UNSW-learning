{% extends 'base.html' %} {% block body_contents %}

{% if form != None %}
<div id="addMsg">

<h1>Add {{title}}</h1>

{% from "includes/_formhelper.html" import render_field %}
<form method="POST" action="">
  <div class="form-group">
    {{ render_field(form.message, class_="form-control", id="editor") }}
  </div>
  <p>
    <input id="submit" class="btn btn-primary" onclick="getGeoPosition();" type="submit" value="Submit">
</form>
{% endif %}
</div>

<div class="container panel-group" >

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <div class="pull-right" id="pagingControls"></div>
        <p>
        {% for m in post_detail['message'] %} {% if m in post_detail['user'] %}
        <a href="{{url_for('profile', zid = m)}}">@{{post_detail['user'][m]}}</a>
        {% elif m == "<br>" %}
        </p><p>
        {% else %} {{m}} {% endif %} {% endfor %}
        </p>
      </h4>
      <div class="row">
        <div class="col-sm-1">
          <a class="pull-right" href="{{url_for('add_comment', pid = post_detail['id'])}}"><span data-toggle="tooltip" title="Add comment" class="glyphicon glyphicon-comment" aria-hidden="true"></span></a>
        </div>
        <div class="col-sm-4">
          <span>Date: {{post_detail['time'][0:10]}} Time: {{post_detail['time'][11:16]}}</span>
        </div>
        {% if 'latitude' in post_detail %}
        <div class="col-sm-1">
          <a class="pull-right" href="https://www.google.com.au/maps/@{{post_detail['latitude'][1:]}},{{post_detail['longitude'][1:]}},17z" target="_blank">
            <span class="glyphicon glyphicon-map-marker" data-toggle="tooltip" title="Click to find the location:{{post_detail['latitude']}}, {{post_detail['longitude']}}" aria-hidden="true"></span></a>
          </div>
          {%endif%}
          <div class="col-sm-3">
            <a href="{{url_for('dlt_post', id=post_detail['id'])}}" method="delete" >
              <span class="glyphicon glyphicon-remove" data-toggle="tooltip" title="Delete this post" aria-hidden="true"></span>
            </a>
        </div>
      </div>
    </div>
      <div class="list-group panel-body">
                
          {% for comment in post_detail['comments'] %}
        
          <div class="list-group-item">
            <div class="row">
              <h4 class="col-sm-6">
                  <a class="pull-right glyphicon glyphicon-expand"  title="Click to view the replies" data-toggle="collapse" href="#collapse{{comment['id']}}"></a>
                  <p>
                    {% for m in comment['message'] %} {% if m in comment['user']%}
                    <a href="{{url_for('profile', zid = m)}}">@{{comment['user'][m]}}</a>
                    {% elif m == "<br>" %}
                    </p><p>
                    {% else %} {{m}} {% endif %} {% endfor%}
                  </p>
                  </a>
                </h4>
              <div class="col-sm-3">
                <span>Date: {{comment['time'][0:10]}} Time: {{comment['time'][11:16]}}</span>
              </div>

              <div class="col-sm-3">
                <a href="{{url_for('add_reply', pid = post_detail['id'], cid = comment['id'])}}">
                    <span class="glyphicon glyphicon-comment" aria-hidden="true"></span></a>
                From:
                <a href="{{url_for('profile', zid = comment['from'][1:])}}">{{comment['user'][comment['from'][1:]]}}</a>
              </div>
            </div>
            <div id="collapse{{comment['id']}}" class="panel-collapse collapse in">
              <div class="panel-body">
                {% for reply in comment['replies'] %}
                <div class="row">
                  <h5 class="panel-title col-sm-5">
                    <p>
                      {% for m in reply['message'] %} {% if m in reply['user']%}
                      <a href="{{url_for('profile', zid = m)}}">@{{reply['user'][m]}}</a>
                      {% elif m == "<br>" %}
                    </p><p>
                      {% else %} {{m}} {% endif %} {% endfor%}
                    </p>
                    </h5>
                  <div class="col-sm-3">
                    <span>Date: {{reply['time'][0:10]}} Time: {{reply['time'][11:-8]}}</span>
                  </div>
                  <div class="col-sm-3">
                    From:   <a href="{{url_for('profile', zid = reply['from'][1:])}}">{{reply['user'][reply['from'][1:]]}}</a>
                  </div>
                </div>
               
                {% endfor%}
              </div>
            </div>
          </div>
          {% endfor%}
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
<script type="text/javascript">
  
  
  var Imtech = {};
  Imtech.Pager = function() {
      this.paragraphsPerPage = 3;
      this.currentPage = 1;
      this.pagingControlsContainer = '#pagingControls';
      this.pagingContainerPath = '.list-group';
      this.numPages = function() {
          var numPages = 0;
          if (this.paragraphs != null && this.paragraphsPerPage != null) {
              numPages = Math.ceil(this.paragraphs.length / this.paragraphsPerPage);
          }
          return numPages;
      };
      this.showPage = function(page) {
          this.currentPage = page;
          var html = '';
          this.paragraphs.slice((page-1) * this.paragraphsPerPage,
              ((page-1)*this.paragraphsPerPage) + this.paragraphsPerPage).each(function() {
              html += '<div>' + $(this).html() + '</div>';
          });
          $(this.pagingContainerPath).html(html);
          renderControls(this.pagingControlsContainer, this.currentPage, this.numPages());
      }
      var renderControls = function(container, currentPage, numPages) {
          var pagingControls = '<ul class="pagination pagination-sm">';
          for (var i = 1; i <= numPages; i++) {
              if (i != currentPage) {
                  pagingControls += '<li><a href="#" onclick="pager.showPage(' + i + '); return false;">' + i + '</a></li>';
              } else {
                  pagingControls += '<li class="active"><a href="#">' + i + '</a></li>';
              }
          }
          pagingControls += '</ul>';
          $(container).html(pagingControls);
      }
  }
  
  var pager = new Imtech.Pager();
  $(document).ready(function() {
     pager.paragraphsPerPage = 5; // set amount elements per page
     pager.pagingContainer = $('.list-group'); // set of main container
     pager.paragraphs = $('.list-group-item', pager.pagingContainer); // set of required containers
     console.log(pager.paragraphs)
     pager.showPage(1);
  });
  
  </script>
{% endblock %}
